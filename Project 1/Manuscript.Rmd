---
title: "Magnitude of response for Soil Test P"
author: "Sofia Cominelli, Abraham Arbelaez"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

As a general guideline, consider:
Introduction 200-400 words 
M&M 200-500 words
Results 100-400 words
Discussion 150-300 words
Conclusion ~100 words 

# Introduction
Phosphorus (P) is an essential macronutrient for crop growth, and profitable crop production depends on maintaining adequate levels of P and other nutrients. Effective planning of P fertilization has become increasingly important because grain and fertilizer prices are highly variable, and because public concern is growing regarding water quality and environmental impacts associated with P losses from agricultural fields.

Soil testing is a useful, although imperfect, diagnostic tool that guides P fertilizer recommendations. The process begins with collecting a soil sample, typically from the 0 to 15 cm depth. The soil test method then attempts to extract a portion of the soil P that is proportional to the P available for crop uptake. This extracted fraction represents only a small part of the total P in the soil, and it can vary across soil types, management histories, and environmental conditions.

For soil testing to be useful within a given region, the soil test must be calibrated. Calibration involves identifying the soil test level or range that separates responsive from non-responsive soils (the critical level or critical range), and determining the fertilizer rate required for each soil test category. Soil test interpretation commonly groups soils into categories such as very low, low, optimum, high, and very high, each defined by the probability that a site will respond to P fertilization.

As soil test levels increase, both the probability of observing a yield response and the magnitude of the expected response decline. Previous research has shown that the percentage of P applications that result in yield increases is approximately 80 percent for very low soil test P, 65 percent for low, 25 percent for optimum, 5 percent for high, and less than 1 percent for very high.


In this context, the objective of this project is to evaluate unsupervised classification methods for identifying patterns in wheat site responses to phosphorus fertilization. Specifically, we compare approaches such as k means clustering ([Likas et al., 2003](https://doi.org/10.1016/S0031-3203(02)00060-2)), fuzzy c-means ([Bezdek et al., 1984](https://doi.org/10.1016/0098-3004(84)90020-7)), and archetypal analysis  ([Cutler and Breiman, 1994](https://doi.org/10.1080/00401706.1994.10485840)) to determine how consistently they capture meaningful site groupings. By linking clusters to expert decisions, the project aims to identify which classification strategies provide the most informative and accurate guidance for fertilizer management.

# Materials and Methods:
## Dataset
The dataset for this project comes from Kansas winter wheat phosphorus trials conducted in 2019 and 2020. The dataset included 24 site years. Phosphorus was applied as monoammonium phosphate (MAP), with four replications per site year. The P application rates were 0, 45, 90, and 135 kg P per hectare. Analyses in this study used only plots that received MAP or served as unfertilized checks.

## Statistic
Grain yield response to P fertilization across all sites was analyzed using a linear mixed model. Phosphorus rate (0, 45, 90, and 135 kg P per hectare) was treated as a fixed categorical effect, and site-year was included as a random effect to account for differences among environments. The model was fitted by restricted maximum likelihood using the function lmer from the lme4 package in R. Model residuals were evaluated using simulation based diagnostics from the DHARMa package. Estimated marginal means of grain yield for each P rate were obtained with the emmeans package and used to describe the overall yield response to P across all sites.

For each site year, plot level data were then summarized into site level response metrics. Mean grain yield was calculated for each P rate and site year, and used to derive the yield of the unfertilized control, the maximum yield among P rates, the absolute yield increase (maximum minus control), and the relative yield of the control (control yield divided by maximum yield, expressed as a percentage). In addition, a simple linear regression of yield on P rate was fitted separately for each site year to obtain the intercept and slope of a linear response model. Average soil test P for each site year was computed from preplant soil samples. These variables were combined into a site level table that characterized the magnitude and pattern of response at each site year.

Three unsupervised classification methods were applied to group site years according to their responsiveness to P fertilization: k means clustering, fuzzy c means clustering, and archetypal analysis. K means clustering partitions the data into $k$ non overlapping clusters by repeatably assigning each site year to the nearest cluster centroid, updating the centroids as the mean of the sites in each cluster, and repeating these steps until cluster assignments stabilize. In this method, each site year belongs to exactly one cluster.The Fuzzy c means clustering uses a similar iterative procedure, but allows partial membership in multiple clusters. Instead of assigning each site year to a single group, the algorithm assigns membership values between 0 and 1 for each cluster, with higher values indicating stronger association. Cluster centroids are updated as weighted averages of the site years, where the weights are the membership values, and memberships are updated based on distances to the centroids until they converge. This approach is more flexible and is useful when site years do not fit clearly into a single group. Archetypal analysis does not assume the presence of discrete clusters. Instead, it identifies a small set of extreme response profiles, called archetypes, that lie near the boundary of the multivariate data cloud. Each site year is then expressed as a convex combination of these archetypes, which provides a transparent description of how closely each site resembles the different pure response types.

# Results

# Discussion

# Conclusion